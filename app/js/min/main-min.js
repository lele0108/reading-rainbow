var scotchApp=angular.module("readingRainbow",["ngRoute"]);scotchApp.config(function(e){e.when("/",{templateUrl:"pages/home.html",controller:"mainController"})}),scotchApp.filter("unsafe",function(e){return e.trustAsHtml}),scotchApp.controller("homeController",function(e){e.message="Everyone come and see how good I look!",e.query,e.request=require("request"),e.Q=require("q"),e.fs=require("fs"),e.kickass=require("kickass-search"),e.stream=function(){e.kickass.search("ebooks","great gatsby").then(function(o){e.mostSeeders(o).then(function(o){console.log(JSON.stringify(o)),e.download(o.magnet.href)})})},e.download=function(o){var n=require("webtorrent"),r=new n,t;r.download(o,function(o){console.log("Torrent info hash:",o.infoHash),o.files.forEach(function(o){var n=o.createReadStream(),r=e.fs.createWriteStream(o.name);n.pipe(r),console.log(r),console.log("done")})})},e.mostSeeders=function(o){if(!o||0==o.length)return console.log("ERROR"),null;var n=e.Q.defer();return e.compareSeeds(o).then(function(e){n.resolve(e)}),n.promise},e.compareSeeds=function(o){for(var n=e.Q.defer(),r=o[0],t=1;t<o.length;t++)parseInt(r.seed)<parseInt(o[t].seed)&&(r=o[t]);return n.resolve(r),n.promise}}),scotchApp.controller("bookController",function(e){e.message="Everyone come and see how good I look!"}),scotchApp.controller("readController",function(e){outerScope=e,e.readEPub=function(e){var o=require("epub"),n=new o("test.epub","/imagewebroot/","/articlewebroot/");n.on("error",function(e){throw console.log("ERROR\n-----"),e}),n.on("end",function(){n.getChapter(n.spine.contents[4].id,function(e,o){return outerScope.text="aa",e?void console.log(e):(console.log("\nFIRST CHAPTER:\n"),outerScope.text=o,outerScope.$apply(),console.log(outerScope.text),void console.log(o.substr(0,512)+"..."))})}),n.parse()},e.readEPub()});